# Exercises: Add A User

For details see [Issue a Certificate for a Kubernetes API Client Using A CertificateSigningRequest]
For more details visit [How to issue a certificate for a user]

Practice this until you can do it without this guide if you plan to take the
CKA exam.

NOTE: Remember if you mess up, you can recover with the super-admin config in
`/etc/kubernetes/super-admin.conf`

1. Make a new X.509 certificate key-pair for the user `jump-box`.
2. Issue a signing request (CSR) for the `jump-box` certificate.
3. Make a Kubernetes CertificateSigningRequest using the `jump-box` CSR.
4. Approve the request.
5. Get the certificate and save it as `jump-box.crt`.
6. Get the cluster CA certificate and save it as `ca.crt` in the current
   directory.
7. Make a new cluster role binding for the `jumb-box` to grant it
   `cluster-admin` privileges.
8. Make a new kubeconfig for the `jump-box` user and set it as the default.
9. Test the config works with the following commands:
    * `kubectl auth whoami`
    * `k get pods -A`.

## Add User with kubeadm

Generate a cluster admin kubeconfig using kubeadm:

```shell
mkdir -p ~/.kube
# NOTE: The config kubeadm-conf.yaml must exist on the control-plane-01 machine.
ssh vagrant@control-plane-01 sudo kubeadm kubeconfig user --client-name=jump-box --org=kubeadm:cluster-admins --config=kubeadm-conf.yaml | tee -a ~/.kube/config
```

---

[How to issue a certificate for a user]: https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/#normal-user
[Signing certificate signing requests (CSR) generated by kubeadm]: https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-certs/#signing-csr
[Issue a Certificate for a Kubernetes API Client Using A CertificateSigningRequest]: https://kubernetes.io/docs/tasks/tls/certificate-issue-client-csr/
