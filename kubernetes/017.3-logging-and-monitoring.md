# Logging and Monitoring

Kubernetes does not come with a full monitoring solution, but there are Open Source options like:

* Metrics Server - 1 server per cluster, in memory so no historical metrics.
* Prometheus,
* Elastic Stack
* DataDog
* Dynatrace

**cAdvisor** is a subcomponent of Kubelet, which provides performance metrics for the metrics server.

To get started with metrics-server if using MiniKube, run: `mninikube addons enable metrics=server`. For others, you can clone the metrics server: `git clone https://github.com/kubernetes-incubator/metrics-server` then deploy the required components with: `k create -f deploy/1.8+/`. Given some time after its started running metrics can be viewed by running `k top node` for performance metrics of nodes or `k top pod` for performance metrics of pods.

## Logs

`docker run kodekloud/event-simulator` to simulate logs.

Run the image in a POD:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: log-simulator
  labels:
    type: simulator
spec:
  containers:
    - name: kodekloud-event-simulator
      image: kodekloud/event-simulator
```

Run the POD to simulate logs `k create -f event-simulator.yml`.

You will not see the logs since they are running in the pod. To see the logs of the POD you need to run:
`k logs -f log-simulator`

If there are multiple containers running in the POD, then you MUST specify which container:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: log-simulator
  labels:
    type: simulator
spec:
  containers:
    - name: kodekloud-event-simulator
      image: kodekloud/event-simulator
    - name: busybox
      image: busybox
```

Run the POD `k create -f event-simulator.yml`.
View the logs of the event simulator: `k logs -f log-simulator kodekloud-event-simulator`


# Container Logs

To view logs of a container you can use the following:

`k -n default exec -it <pod-name> -- cat /log/app.log`

## initContainers

At times, you may want to run a process that runs to completion in a container. A task that will be run only one time when the pod is first created. Or a process that waits for an external service or database to be up before the actual application starts.

An initContainer is configured in a pod-like all other containers, except that it is specified inside a initContainers section, like this:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
  labels:
    app: myapp
spec:
  containers:
  - name: myapp-container
    image: busybox:1.28
    command: ['sh', '-c', 'echo The app is running! && sleep 3600']
  initContainers:
  - name: init-myservice
    image: busybox
    command: ['sh', '-c', 'git clone  ;']

```

When a POD is first created the initContainer is run, and the process in the initContainer must run to a completion before the real container hosting the application starts.

If any of the initContainers fail to complete, Kubernetes restarts the Pod repeatedly until the Init Container succeeds.
