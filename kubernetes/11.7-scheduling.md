# Scheduler

Every Pod has a field `nodeName` that by default is not set.
1. The scheduler goes though all the Pods and looks for those that do not have
   this property set, and selects them as candidates for scheduling.
2. It then selects a Pod and runs an algorithm to identify the right node for
   the Pod.
3. It then schedules the Pod to be placed on the node by setting the `nodeName`
   to the name of the node, for the Pod, by creating a binding object.

## Manual Scheduling

To manually assign a node you have 2 ways:
1. You can assign a nodeName at the time of making the new Pod.
2. Make a binding object, as the scheduler does, for the Pod, but this must be sent as a JSON object over to the Pods biding API with the data:
   ```yaml
   apiVersion: v1
   kind: Binding
   metadata:
     name: nginx
   target:
     apiVersion: v1
     kind: Node
     name: node02
   ```
   ```sh
   SERVER='control-plane:6443'
   POD_NAME="nginx"
   cat <<HDOC > pod-binding-data.json
   {
     "apiVersion": "v1",
     "kind": "Binding",
     "metadata": {
        "name": "nginx",
     }
     "target": {
       "apiVersion": "v1",
       "kind": "Node",
       "name": "worker-01"
     }
   }
   HDOC

   curl -k --header "Content-Type: application/json" \
       --header "Authorization: Bearer ${K8_TOKEN}" \
       --request POST --data @./pod-binding-data.json \
       https://${SERVER}/api/v1/namespaces/default/pods/${POD_NAME}/binding
   ```

## Configure Kubernetes Scheduler

```yaml
apiVersion: v1
kind: Pod
metadata:
   name: multi-pod
   labels:
      name: multi-pod
spec:
   containers:
      - name: alpha
        image: nginx
        env:
           - name: "name"
             value: "alpha"
      - name: beta
        image: busybox
        command: [ sleep, "4800" ]
        env:
           - name: "name"
             value: "beta"
---
apiVersion: v1
kind: Pod
metadata:
   name: non-root-pod
   labels:
      name: non-root-pod
spec:
   securityContext:
      runAsUser: 1000
      fsGroup: 2000
   containers:
      - name: non-root-pod
        image: redis:alpine
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
   name: ingress-to-nptest
spec:
   podSelector:
      matchLabels:
         run: np-test-1
   policyTypes:
      - Ingress
   ingress:
      - ports:
           - protocol: TCP
             port: 80
---
apiVersion: v1
kind: Pod
metadata:
   name: prod-redis
   labels:
      name: prod-redis
spec:
   containers:
      - name: prod-redis
        image: redis:alpine
   tolerations:
      - key: "env_type"
        operator: "Equal"
        value: "production"
        effect: "NoSchedule"
---
apiVersion: v1
kind: Pod
metadata:
   name: hr-pod
   namespace: hr
   labels:
      name: hr-pod
      environment: production
      tier: frontend
spec:
   containers:
      - name: hr-pod
        image: redis:alpine
```