# Kubernetes Components Certificates

These components use TLS authentication to authenticate with each other:

* etcd
* kube-apiserver
* kube-controller-manager
* kube-scheduler
* kubelet
* and kube-proxy

Most of the time a component needs to authenticate with the `kube-apiserver`.
However, the `kube-apiserver` needs to authenticate with the `etcd` and
`kubelet` servers.

Each components certificate contains the user or CN (Common Name) and group or O
(Organization) that they identify as. Here's a chart of each components
certificate info.

## List of Certificates of Notes

These are important for running a control-plane. And use

Legend:
CA = Certificate Authority
CN = Common Name
O  = Organization
type = keyUsage - an X509v3 extension.

| Certifcate by location                                  | component               | user (CN)                      | group (Organization)           | SANs                                                                                                                | type                   |
|---------------------------------------------------------|-------------------------|--------------------------------|--------------------------------|---------------------------------------------------------------------------------------------------------------------|------------------------|
| /etc/kubernetes/pki/etcd/ca.{key,crt}                   | etcd                    | etcd-ca                        |                                | etcd-ca, localhost, control-plane-01, control-plane, 127.0.0.1, 0:0:0:0:0:0:0:1, \${IPv4_address}, \${IPv6 address} | CA,critical, digitalSignature, keyEncipherment,cRLSign, keyCertSign                    |
| /etc/kubernetes/pki/etcd/server.{key,crt}               | etcd                    | control-plane-01               |                                | localhost, control-plane-01, control-plane, 127.0.0.1, 0:0:0:0:0:0:0:1, \${IPv4_address}, \${IPv6 address}          | serverAuth, clientAuth |
| /etc/kubernetes/pki/etcd/healthcheck-client.{key,crt}   | etcd                    | kube-etcd-healthcheck-client   |                                |                                                                                                                     | clientAuth             |
| /etc/kubernetes/pki/etcd/peer.{key,crt}                 | etcd                    | control-plane-01               |                                | localhost, control-plane-01, control-plane, 127.0.0.1, 0:0:0:0:0:0:0:1, \${IPv4_address}, \${IPv6 address}          | serverAuth, clientAuth |
| /etc/kubernetest/pki/ca.{key,crt}                       | kube-apiserver          | kubernetes                     |                                |                                                                                                                     | CA                     |
| /etc/kubernetest/pki/apiserver.{key,crt}                | kube-apiserver          | kube-apiserver                 |                                |                                                                                                                     |
| /etc/kubernetest/pki/apiserver-kubelet-client.{key,crt} | kube-apiserver          | kube-apiserver-kubelet-client  | system:masters                 |                                                                                                                     | clientAuth             |
| /etc/kubernetes/pki/sa.{key,crt}                        |                         |                                |                                |                                                                                                                     |                        |
| /etc/kubernetes/pki/front-proxy-ca.{key,crt}            |                         | front-proxy-ca                 |                                | front-proxy-ca                                                                                                      | CA                     |
| /etc/kubernetes/pki/front-proxy-client.{key,crt}        |                         | front-proxy-client             |                                |                                                                                                                     | clientAuth             |
| /etc/kubernetes/kube-controller-manager.conf            | kube-controller-manager | system:kube-controller-manager | system:kube-controller-manager |                                                                                                                     | clientAuth             |
| /etc/kubernetes/kube-scheduler.conf                     | kube-scheduler          | system:kube-scheduler          |                                |                                                                                                                     | clientAuth             |
| var/lib/kubelet/pki/kubelet.{key,crt}                   | kubelet                 | system:node:\${NODE_NAME}      | system:nodes                   |                                                                                                                     | clientAuth, serverAuth | 

TLS authentication is used, whenever possible, to allow one component to
communicate with another.

Each component has a:
1. `key` - Generated by openssl. 
2. `certificate` - that has been signed by a Certificate Authority.

A certificate can be thought of as a photo ID, like a driver's license, that
was signed by someone. In the case of the driver's license they are signed
by your local government. This should grant you the right to drive a car on
public streets (network of roads). The state is your namespace, but your
permitted to drive in other states in your own country.

For a component, we can generate them a certificate, then sign it with the
cluster's Certificate Authority. Depending on the group (Organization) on the
certificate, the user (Common Name) may be permitted to make successful API
request.