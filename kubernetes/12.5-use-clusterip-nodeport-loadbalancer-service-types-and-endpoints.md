# Use ClusterIP, NodePort, LoadBalancer Service Types and Endpoints

Services are an abstract way to expose an application running on a set of Pods.

## Multi-port Services

You must give all of your ports names so that these are unambiguous.

Names for ports must only contain lowercase alphanumeric characters and `-`.
The names 123-abc and web are valid, but 123_abc and -web are not.

## ClusterIP

A ClusterIP is picked from the values specified for the option
`--service-cluster-ip-range=${SERVICE_CIDRS}` to the `kube-apiserver` and
the `kube-controller-manager` components.

Services can have a cluster-scoped virtual IP address using a Service of type
`ClusterIP`.

Clients can then connect using that virtual IP address; and Kubernetes then
load-balances traffic to that Service across the different backing Pods.

That assignment happens one of two ways, from within the configured IP range:

* **dynamically** - the control plane automatically picks a free IP.
* **statically** - you specify an IP address of your choice.

Sometimes you may want to have Services running on known IP addresses. A good
example is the cluster DNS Service. As a soft convention, some Kubernetes
installers assign the 10th IP address from the Service IP range (10.96.0.0/16)
to the DNS service.

Trying to create a Service with a ClusterIP that has already been
allocated will return an error.

The allocation strategy implemented in Kubernetes to allocate ClusterIPs
is divided, based on the formula `min(max(16, cidrSize / 16), 256)`.
to Services reduces the risk of collision.

Dynamic IP assignment uses the upper band by default. This will allow users
to use static allocations on the lower band with a low risk of collision.

For example, the IP address range: 10.96.0.0/16 (CIDR notation) for the IP addresses of Services.

Range Size: `2^16 - 2 = 65534`
Band Offset: `min(max(16, 65536/16), 256) = min(4096, 256) = 256`
Static band start: `10.96.0.1`
Static band ends: `10.96.1.0`
Range end: `10.96.255.254`

## NodePort

The control plane allocates a port from a range specified by
`--service-node-port-range` flag.

Exposes the Service on each Node's IP at a static port.

Meaning Kubernetes allocates a port to match the protocol of the Service.
Every node in the cluster configures itself to listen on that assigned port and
to forward traffic to one of the ready endpoints associated with that Service.

Because of that, the Pod(s) backed by the Service can be contacted from outside
the cluster by connecting to any node using the appropriate protocol and
the appropriate port assigned to that Service.

## LoadBalancer

On cloud providers which support external load balancers, this type exposes
the Service externally using an external load balancer.

The actual creation of the load balancer happens asynchronously, and
information about the provisioned balancer is published in the Service's
`.status.loadBalancer` (you don't set this yourself) field.

On the contrary, some cloud providers do allow you to specify the
`loadBalancerIP`. If you specify a `loadBalancerIP` but the cloud provider
does not support the feature, then it is ignored.

The `.spec.loadBalancerIP` field for a Service was deprecated in Kubernetes
v1.24. If the provider supports specifying via an annotation, then do that.

The set of protocols that can be used for load balanced Services is defined by
your cloud provider

By default, when there is more than one port defined, all ports must have the
same protocol, and supported by the cloud provider. The feature gate
`MixedProtocolLBService`, enabled by default, allows the use of different
protocols.

You can optionally disable node port allocation for a Service of
type `LoadBalancer`, by setting the field `spec.allocateLoadBalancerNodePorts`
to false.

## ExternalName

Maps the Service to the contents of the externalName field (for example,
to the hostname api.foo.bar.example).