# Configure SSH From A JumpBox

Configure the jump-box to allow SSH commands using a key-pair instead of a
password. This is done by hand here since there are only 3-4 machines. If
you are unfamiliar, then this may help you start to understand SSH a bit.

1. SSH into the jump box with `vagrant ssh jump-box`. Remember to be in the same
   directory where you ran `vagrant up`.
2. Once logged in, generate an SSH key-pair with `ssh-keygen`, and follow the
   prompts. (TIP: just hit enter to use the defaults and no password since
   this is a practice environment we will destroy later).
3. You need the IP address assigned to each machine, to get that, log into each
   machine and run `ip address`. This will print out all network device IP
   addresses. If you used this [Vagrantfile], it should be the IP address of the
   third network device listed and begin with `192.168.56.`, for example:
   ```shell
   1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
       link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
       inet 127.0.0.1/8 scope host lo
          valid_lft forever preferred_lft forever
       inet6 ::1/128 scope host noprefixroute
          valid_lft forever preferred_lft forever
   2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
       link/ether 08:00:27:1e:e8:85 brd ff:ff:ff:ff:ff:ff
       inet 10.0.2.15/24 metric 100 brd 10.0.2.255 scope global dynamic enp0s3
          valid_lft 85781sec preferred_lft 85781sec
       inet6 fd17:625c:f037:2:a00:27ff:fe1e:e885/64 scope global dynamic mngtmpaddr noprefixroute
          valid_lft 86050sec preferred_lft 14050sec
       inet6 fe80::a00:27ff:fe1e:e885/64 scope link
          valid_lft forever preferred_lft forever
   3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
       link/ether 08:00:27:d0:01:59 brd ff:ff:ff:ff:ff:ff
       inet 192.168.56.11/24 brd 192.168.56.255 scope global enp0s8
          valid_lft forever preferred_lft forever
       inet6 fe80::a00:27ff:fed0:159/64 scope link
          valid_lft forever preferred_lft forever
    ```
   In this case the IP would be `192.168.56.11`, we drop the `/24` part (which
   means the number of bits in the subnet mask set to 1 or simply put the part
   that defines the network).
4. Back on the jump-box save these IPs in a file named `machines.txt`, like so:
      ```shell
   cat <<TXT | tee machines.txt
   192.168.56.11 control-plane-01
   192.168.56.21 worker-01
   192.168.56.22 worker-02
   TXT
   ```
5. Back on the jump-box, append the machines.txt file to the system
   `/etc/hosts` file so that hostnames can be used instead of IPs for
   communication; Run: `cat machines.txt | sudo tee -a /etc/hosts`.

   NOTE: It is a great idea to back up this file before you edit it:
   `sudo cp /etc/hosts /etc/hosts.original`.
6. Copy the new SSH ID over to each machine. Let's use a shell loop to read the
   lines from the `machines.txt` file like so:
   ```shell
   while read IP HOST
   do
        ssh-copy-id vagrant@${HOST}
   done < machines.txt
   ```
7. If you plan to use hostnames in place of IPs, then it is a good idea to
   append the `machines.txt` file to the `/etc/hosts` file of all the cluster
   machines as well. If our SSH from our jump-box is set up correctly we can use
   a shell loop like this:
   ```shell
   while read IP HOST
   do
        cat machines.txt | ssh vagrant@${HOST} sudo tee -a /etc/hosts
   done < machines.txt
   ```

---

[Vagrantfile]: /kubernetes/samples/Vagrantfile
