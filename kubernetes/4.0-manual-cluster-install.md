# Manual Cluster Install

Though I first leaned how to manually install a cluster with
[Kubernetes The Hard Way], I wanted to comply with current standards. So this
manual process is based on `kubeadm` [Implementation details]. This means that
installation directories, configurations, and PKI should be relatively identical
to that of which `kubeadm` deploys. This helps transition from manual to a tool
assisted installation smoother. Here are the steps you'll need to perform.

1. Prepare the machines for cluster installation by following the
   [Setup A Virtual Environment] guide, then return back here.
2. On each machine:
   1. [Install containerd: Manual Installation] as the CRI of choice.
   2. Install the `kubelet` and `kubectl` packages:
      ```shell
      KUBE_VER=v1.33
      curl -fsSL https://pkgs.k8s.io/core:/stable:/${KUBE_VER}/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
      # Add the appropriate Kubernetes apt repository:
      echo \
        "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/${KUBE_VER}/deb/ /" | sudo tee /etc/apt/sources.list.d/kubernetes.list
      # Update the apt package index, install kubelet and kubectl, and pin their version:
      sudo apt-get update
      sudo apt-get install -y kubelet kubectl
      sudo apt-mark hold kubelet kubectl
      ```
   3. Make default Kubernetes install directories:
      ```shell
      sudo mkdir -p /etc/kubernetes/{manifests,pki}
      sudo mkdir -p /etc/kubernetes/pki/etcd
      sudo mkdir -p /var/lib/kubelet/pki
      ```
      NOTE: To better understand where these paths come from, have a quick read
      of [Constants and well-known values and paths].
3. Choose IP CIDR ranges for the Pod and Service networks. You can include
   both IPv4 and IPv6 if your going dual stack. For brevity, use the ones
   provided here. They are from examples in the Kubernetes documentation, which
   are private class for IPv4 and global unicast for IPv6:
   ```text
   IPv4 POD network:     10.244.0.0/16
   IPv4 Service Network: 10.96.0.0/16
   IPv6 POD network:     2001:db8:42:0::/56
   IPv6 Service Network: 2001:db8:42:1::/112
   ```
   NOTE: Feel free to choose other CIDRs you want, and if it breaks just
   remember that is more troubleshooting to benefit your learning.
4. On `control-plane-01`:
   1. [Generate Control Plane Certificates Manually],
   2. [Generate Control Plane kubeconfigs Manually],
   3. [Generate Static Pod Manifests],
   4. [Initialize the Control Plane]
   5. [Configure Networking].
5. [Add Workers].

---

[Kubernetes The Hard Way]: https://github.com/kelseyhightower/kubernetes-the-hard-way
[Constants and well-known values and paths]: https://kubernetes.io/docs/reference/setup-tools/kubeadm/implementation-details/#constants-and-well-known-values-and-paths
[Implementation details]: https://kubernetes.io/docs/reference/setup-tools/kubeadm/implementation-details/#constants-and-well-known-values-and-paths
[Generate Control Plane kubeconfigs Manually]: /kubernetes/4.2-generate-control-plane-kubeconfigs-manually.md
[Generate Static Pod Manifests]: /kubernetes/4.3-generate-static-pod-manifests.md
[Configure Networking]: /kubernetes/4.5-configure-networking.md
[Add Workers]: /kubernetes/4.6-add-workers.md
[Setup A Virtual Environment]: /kubernetes/2.0-setup-a-virtual-environment.md
[Install containerd: Manual Installation]: /kubernetes/3.0-install-containerd.md
[Generate Control Plane Certificates Manually]: /kubernetes/4.1-generate-control-plane-certificates-manually.md
[Initialize the Control Plane]: /kubernetes/4.4-initialize-the-control-plane.md
