# etcd

The key-value database for the `kube-apiserver`. It stores the state of the
cluster. If you have a recent backup of the etcd database, then you can always
restore the cluster to that state.

This data is NOT encrypted. If you want encryption you can encrypt the backup.

This component should come first when bringing up a cluster, and here's why.
If you spin up the `kube-apiserver` first then it has to wait for the etcd
service before it can store any data.

`etcdctl` is the CLI tool used to interact with `etcd` server using API
versions 2 (the default) or 3.

Version 2 supports the following commands:

```shell
etcdctl backup
etcdctl cluster-health
etcdctl mk
etcdctl mkdir
etcdctl set
```

Whereas version 3

```shell
etcdctl snapshot save
etcdctl endpoint health
etcdctl get
etcdctl put
```

To set the right version of API set the environment variable ETCDCTL_API command

```shell
export ETCDCTL_API=3
```

Apart from that, you must also specify the path to certificate files so that
`etcdctl` can authenticate using TLS with the `etcd` server. The certificate
files are available, by default, at the following paths.

```text
--cacert /etc/kubernetes/pki/etcd/ca.crt
--cert /etc/kubernetes/pki/etcd/server.crt
--key /etc/kubernetes/pki/etcd/server.key
```

Use `etcdctl` to ...:

``` shell
kubectl exec etcd-control-plane-01 -n kube-system -- sh -c "ETCDCTL_API=3 etcdctl get / --prefix --keys-only --limit=10 \
--cacert /etc/kubernetes/pki/etcd/ca.crt \
--cert /etc/kubernetes/pki/etcd/server.crt \
--key /etc/kubernetes/pki/etcd/server.key"
```
