# Exercises

1. Make a deployment named "nginx-dp1", based on the latest version of Nginx,
   and with 2 replicas. Give it `1 Gi` of [Local] storage, mounted in the
   container at `/usr/share/nginx/html`. It should use a Storage class named
   "local-storage". Give any other objects that you need to make the
   suffix `-dp1`.

   **Requirements**
   ```text
   deployment name: nginx-dp1
   deployment replicas count: 2
   persistent volume claim size: 1Gi
   persistent volume claim mount point: /usr/share/nginx/html
   storage class name: local-storage
   ```
   1. Once the containers have successfully deployed; place a file on each
      worker named `/usr/share/nginx/html/index.html` with the HTML content
      shown, replacing the `{node-name}` with the node machine's hostname.
      ```html
       <!DOCTYPE html>
       <html lang="en">
           <head>
               <meta charset="UTF-8" />
               <title></title>
           </head>
           <body>
               <div>{node-name}</div>
           </body>
       </html>
      ```

2. Now that you have a deployment, make a [Service] using NodePort named
   `nginx-dp1-svc`.
   1. Retrieve the node port assigned to the `nginx-dp1-svc` service:
      ```bash
      NODE_PORT=$(kubectl get svc nginx-dp1-svc \
        -o jsonpath='{.spec.ports[0].nodePort}')
      ```
   2. Retrieve the hostname of the node running the `nginx` pod:
      ```bash
      NODE_NAME=$(kubectl get pods \
        -l app=nginx-yxz \
        -o jsonpath="{.items[0].spec.nodeName}")
      ```
   3. Make an HTTP request using the IP address and the `nginx` node port:
      ```bash
      curl http://${NODE_NAME}:${NODE_PORT}/index.html
      ```

3. Make a new deployment with the image `nginx` and named `http-server`, and
   store HTML in a ConfigMap. Mount the ConfigMap in the container at
   `/usr/share/nginx/html/index.html`. Use the following HTML in the config map:
   ```html
   <!DOCTYPE html>
   <html lang="en">
       <head>
           <meta charset="UTF-8" />
           <title></title>
       </head>
       <body>
           <div>Salam</div>
       </body>
   </html>
   ```

---

[Local]: https://kubernetes.io/docs/concepts/storage/storage-classes/#local
[Service]: /kubernetes/service.md
