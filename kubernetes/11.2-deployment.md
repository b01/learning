# Deployment

Manages a set of Pods to run an application workload.

It provides declarative updates for Pods and ReplicaSets.

It describes a desired state, and the Deployment Controller changes the
actual state to the desired state at a controlled rate.

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: http-server-dp
  labels:
    uid: abc123
spec:
  replicas: 3
  selector:
    matchLabels:
      uid: abc123
  template:
    metadata:
      labels:
        uid: abc123
        app: nginx
        kind: server
        mode: backend
        type: dynamic
        format: html
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80
```

## Updates and Rollbacks

A Rollout is triggered when you first make a deployment, which makes a new
rollout revision. Every update increments and makes a new revision.

```shell
k rollout status deploy/<name>
k rollout history deploy/<name>
```

## Strategies

**Recreate**

1. destroy all pods
2. rollout new pods.

**Rolling Update** is the default

1. delete 1 rollout 1 new one
2. Repeat step 1 until all pods are replaced.

An example of an update can be that you want to update the image. Which you can
do with:
1. Updating the deployment config yaml
   ```shell
   kubectl edit deploy/<name>
   ```
   NOTE: Using `kubectl edit deploy/<name>` to change just the number of
   replicas updates the replicas but not the revision.
2. Manually from the CLI with
   ```shell
   k set image deploy/<name> CONTAINER_NAME=<new-image>
   ```

You can see a difference in the update strategy when you `describe` the
deployment and view the StrategyType field and the Events.

## Rollback

Allows you to roll changes back to a previous revision with
```shell
k rollout undo deployment-name
```
